<!-- HTML header for doxygen 1.8.13-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.13"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MTB CAT1 Peripheral driver library: Startup CAT1D</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript">
  $(document).ready(initResizable);
</script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen_style.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><a href="http://www.cypress.com/"><img alt="Logo" src="IFXCYP_one-line.png"/></a></td>
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">MTB CAT1 Peripheral driver library</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.13 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(document).ready(function(){initNavTree('group__group__system__config__1d.html','');});
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#groups">API Reference</a>  </div>
  <div class="headertitle">
<div class="title">Startup CAT1D<div class="ingroups"><a class="el" href="group__group__startup__config.html">Startup</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<a name="details" id="details"></a><h2 class="groupheader">General Description</h2>
<p>Provides device startup, system configuration, and linker script files. </p>
<p>The system startup provides the followings features:</p><ul>
<li><a class="el" href="group__group__system__config__1d.html#group_system_config_device_memory_definition_1d">Device Memory Definition</a></li>
<li><a class="el" href="group__group__system__config__1d.html#group_system_config_device_initialization_1d">Device Initialization</a></li>
<li><a class="el" href="group__group__system__config__1d.html#group_system_config_heap_stack_config_1d">Heap and Stack Configuration</a></li>
<li><a class="el" href="group__group__system__config__1d.html#group_system_config_default_handlers_1d">Default Interrupt Handlers Definition</a></li>
<li><a class="el" href="group__group__system__config__1d.html#group_system_config_device_vector_table_1d">Vectors Table Copy from Flash to RAM</a></li>
</ul>
<h1><a class="anchor" id="group_system_config_configuration_1d"></a>
Configuration Considerations</h1>
<h2><a class="anchor" id="group_system_config_device_memory_definition_1d"></a>
Device Memory Definition</h2>
<p>Allocation of different types of memory such as the ROM, flash and RAM etc. for the CPU is defined by the linker scripts.</p>
<dl class="section note"><dt>Note</dt><dd>The linker files provided with the PDL are generic and handle all common use cases. Your project may not use every section defined in the linker files. In that case you may see warnings during the build process. To eliminate build warnings in your project, you can simply comment out or remove the relevant section in the linker file.</dd></dl>
<p><b>ARM GCC</b><br />
The flash and RAM sections for the CPU are defined in the linker files: 'xx_yy_zz.ld', where 'xx' is the device group, 'yy' is the secure or non secure, and zz is the memory type; for example, 'pse84_ns_ram.ld' and 'pse84_s_flash.ld'. </p><dl class="section note"><dt>Note</dt><dd>If the start of the Cortex-M33 application image is changed, the value of the <a class="el" href="group__group__system__config__user__settings__macro__1d.html#ga79175ac57df138fdb2010643dacb1911">CY_CORTEX_M33_SEC_APPL_ADDR</a> should also be changed. The <a class="el" href="group__group__system__config__user__settings__macro__1d.html#ga79175ac57df138fdb2010643dacb1911">CY_CORTEX_M33_SEC_APPL_ADDR</a> macro should be used as the parameter for the <a class="el" href="group__group__system__config__cm33__functions__1d.html#gad4a07f4a887071824a6c5fe1ee561959" title="Sets vector table base address and enables the Cortex-M33 core in secure mode. ">Cy_SysEnableCM33()</a> function call.</dd>
<dd>
If the start of the Cortex-M55 application image is changed, the value of the <a class="el" href="group__group__system__config__user__settings__macro__1d.html#ga02de510de4ee1e844aa544b0db2c5b90">CY_CORTEX_M55_APPL_ADDR</a> should also be changed. The <a class="el" href="group__group__system__config__user__settings__macro__1d.html#ga02de510de4ee1e844aa544b0db2c5b90">CY_CORTEX_M55_APPL_ADDR</a> macro should be used as the parameter for the <a class="el" href="group__group__system__config__cm55__functions__1d.html#gacb269be06ab3af9c23202efe7c2ff255" title="Sets vector table base address and enables the Cortex-M55 core. ">Cy_SysEnableCM55()</a> function call.</dd></dl>
<p>Change the code and data sizes by editing the macros values in the linker files for both CM33 and CM55 CPUs:</p><ul>
<li>'pse84_ns_zz.ld', where 'zz' is the device memory type: <div class="fragment"><div class="line">code       (rx)     : ORIGIN = CODE_VMA, LENGTH = CODE_SIZE</div><div class="line">data       (rwx)    : ORIGIN = DATA_VMA, LENGTH = DATA_SIZE</div></div><!-- fragment --></li>
</ul>
<h2><a class="anchor" id="group_system_config_device_initialization_1d"></a>
Device Initialization</h2>
<p>After a power-on-reset (POR), the boot process is handled by the boot code from the on-chip ROM that is always executed by the Cortex-M0+ core. The boot code passes the control to the Cortex-M33 startup code and Cortex-M33 boots the Cortex-M55 core.</p>
<p><b>CM33 Boot</b><br />
 CM33 always boots in secure mode after reset. Then, the secure code switches execution to non-secure mode. Each execution environment has its own application image. Each application image contains its startup code. So, there are two separate startup codes. One is for secure execution environment, part of secure application image and other one is for non-secure execution environment, part of non-secure application image. Execution of startup code is triggered by the secure code after it completes the initialization during boot process. It switches control to non-secure startup code by switching processor execution state to non-secure state.<br />
The secure code is programmed in RRAM NVM MAIN region. This code executes in place (XIP) from RRAM. First secure code to execute on CM33 is CM33_L1_BOOTLOADER. The CM33_L1_BOOTLOADER, SE_RRAM_BOOT code is launched by the code executing on CM0P core in secure enclave by setting the address of the image entry point in the CM33_S_VECTOR_TABLE_BASE (S_VTOR) register and setting the CM33_CTL.CPUWAIT to LOW to allow execution of reset handler of secure image. Address of CM33_L1_BOOTLOADER image entry point is obtained from the TOC2 table entry CM33_L1_BOOTLOADER_ADDR.</p>
<p><b>CM55 Boot</b><br />
 The CM55 CPUSS is OFF by default upon POR. CM55 application is launched from CM33 non-secure application depending on the use case requirements. CM55 Application is programmed executed in place from the external flash. The C runtime code will copy necessary code to SOCMEM and other memory areas depending on the choice made for the execution region in the linker script. CM55 execution is held by its CM55_CTL.CPU_WAIT (which will be HIGH) till released (made LOW) by CM33 app to launch the CM55 code after programming the CM55 VTOR with the image entry point in the targeted memory.</p>
<p>Below sequence diagram captures the initialization process in the startup code. </p><div class="image">
<img src="cm33_bootup_sequence.png" alt="cm33_bootup_sequence.png"/>
</div>
<h2><a class="anchor" id="group_system_config_heap_stack_config_1d"></a>
Heap and Stack Configuration</h2>
<p>By default, the stack size is set to 0x00001000 and the entire remaining ram is used for the heap</p>
<h3><a class="anchor" id="group_system_config_heap_stack_config_gcc_1d"></a>
ARM GCC</h3>
<ul>
<li><b>Editing source code</b><br />
The stack and heap sizes are defined in the linker script file: 'pse84_ns_ram.ld'. Change the stack size by modifying the following line:<br />
<div class="fragment"><div class="line">STACK_SIZE = 0x00001000; </div></div><!-- fragment --> Remaining free RAM is used as heap.</li>
</ul>
<dl class="section note"><dt>Note</dt><dd>Correct operation of malloc and related functions depends on the working implementation of the 'sbrk' function. Newlib-nano (default C runtime library used by the GNU Arm Embedded toolchain) provides weak 'sbrk' implementation that doesn't check for heap and stack collisions during excessive memory allocations. To ensure the heap always remains within the range defined by __HeapBase and __HeapLimit linker symbols, provide a strong override for the 'sbrk' function: <div class="fragment"><div class="line"><span class="keywordtype">void</span> * _sbrk(uint32_t incr)</div><div class="line">{</div><div class="line">    <span class="keyword">extern</span> uint8_t __HeapBase, __HeapLimit;</div><div class="line">    <span class="keyword">static</span> uint8_t *heapBrk = &amp;__HeapBase;</div><div class="line">    uint8_t *prevBrk = heapBrk;</div><div class="line">    <span class="keywordflow">if</span> (incr &gt; (uint32_t)(&amp;__HeapLimit - heapBrk))</div><div class="line">    {</div><div class="line">        errno = ENOMEM;</div><div class="line">        CY_HALT();</div><div class="line">    }</div><div class="line">    heapBrk += incr;</div><div class="line">    <span class="keywordflow">return</span> prevBrk;</div><div class="line">}</div></div><!-- fragment -->For FreeRTOS-enabled multi-threaded applications, it is sufficient to include clib-support library that provides newlib-compatible implementations of 'sbrk', '__malloc_lock' and '__malloc_unlock': <br />
 <a href="https://github.com/Infineon/clib-support">https://github.com/Infineon/clib-support</a>.</dd></dl>
<h3><a class="anchor" id="group_system_config_heap_stack_config_arm_1d"></a>
ARM Compiler</h3>
<p>Currently Not Supported</p>
<h3><a class="anchor" id="group_system_config_heap_stack_config_iar_1d"></a>
IAR</h3>
<p>Currently Not Supported</p>
<h2><a class="anchor" id="group_system_config_default_handlers_1d"></a>
Default Interrupt Handlers Definition</h2>
<p>The default interrupt handler functions are dummy handler in the startup file.<br />
Below is the default handler for the non-secure interrupts:<br />
</p><div class="fragment"><div class="line"> interrupt_type <span class="keywordtype">void</span> InterruptHandler(<span class="keywordtype">void</span>) {</div><div class="line">   <span class="keywordflow">while</span>(1);</div><div class="line">} </div></div><!-- fragment --><h2><a class="anchor" id="group_system_config_device_vector_table_1d"></a>
Vectors Table Copy from Flash to RAM</h2>
<p>This process uses memory sections defined in the linker script. The startup code copies the default vector table contents to the non-secure SRAM region specified by the linker script. APIs are provided in the sysint driver to hook user implemented handler replacing the default handler for the corresponding interrupt.</p>
<p>Following tables provide the address of the default and non-secure SRAM interrupt vector table for different supported compilers. </p>
<h3><a class="anchor" id="group_system_config_device_vector_table_gcc_1d"></a>
ARM GCC</h3>
<p>The linker script file is 'pse84_ns_ram.ld'. For non-secure world, it uses the following variable.<br />
 Copy interrupt vectors from ROM/flash to RAM: <br />
 From:</p><div class="fragment"><div class="line">__ns_vector_table </div></div><!-- fragment --><p> To:</p><div class="fragment"><div class="line">__ns_vector_table_rw </div></div><!-- fragment --><p> The vector table address (and the vector table itself) are defined in the ns_start_&lt;device&gt;.c startup file corresponding to non-secure world. The code in these files copies the vector table from ROM/Flash to RAM.</p>
<h3><a class="anchor" id="group_system_config_device_vector_table_mdk_1d"></a>
ARM Compiler</h3>
<p>Currently Not Supported</p>
<h3><a class="anchor" id="group_system_config_device_vector_table_iar_1d"></a>
IAR</h3>
<p>Currently Not Supported </p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="groups"></a>
API Reference</h2></td></tr>
<tr class="memitem:group__group__system__config__macro__1d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__macro__1d.html">Macros</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__system__config__functions__1d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__functions__1d.html">Functions</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:group__group__system__config__globals__1d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__group__system__config__globals__1d.html">Global Variables</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part
<div id="nav-path" class="navpath">
    <ul>
        <li class="footer">
            Generated for <b>MTB CAT1 Peripheral driver library</b> by <b>Cypress Semiconductor Corporation</b>.
            All rights reserved.
        </li>
    </ul>
</div>
-->
</body>
</html>
